[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "18"

# API 路由重定向到 Netlify Functions
# 注意：这些规则必须在通用路由之前，以确保 API 请求被正确路由
[[redirects]]
  from = "/api/orders/:orderId/status"
  to = "/.netlify/functions/orders-status"
  status = 200

[[redirects]]
  from = "/api/orders/:orderId"
  to = "/.netlify/functions/orders-detail"
  status = 200

[[redirects]]
  from = "/api/cart/:cartId"
  to = "/.netlify/functions/cart-item"
  status = 200

[[redirects]]
  from = "/api/register"
  to = "/.netlify/functions/register"
  status = 200

[[redirects]]
  from = "/api/login"
  to = "/.netlify/functions/login"
  status = 200

[[redirects]]
  from = "/api/categories"
  to = "/.netlify/functions/categories"
  status = 200

[[redirects]]
  from = "/api/products"
  to = "/.netlify/functions/products"
  status = 200

[[redirects]]
  from = "/api/orders"
  to = "/.netlify/functions/orders"
  status = 200

[[redirects]]
  from = "/api/cart"
  to = "/.netlify/functions/cart"
  status = 200

# 重定向规则 - 所有其他路由都指向 index.html（用于 React Router）
# 这个规则必须在最后，以确保 API 路由优先匹配
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

